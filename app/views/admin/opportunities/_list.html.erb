<%= form_tag admin_opportunities_path, method: :get, id: 'opportunity-filters' do %>
  <%= select_tag(:filter, grouped_options_for_select(opportunity_filters, params[:filter]), include_blank: 'Unfiltered Opportunities')%>
  
  <%= submit_tag 'filter' %>
<% end %>

<% if opportunities.empty? %>
  <p class="empty-list">There are no opportunities to show here.</p>
<% else %>
  <%= form_tag export_admin_opportunities_path(format: 'csv'), method: :post do %>
    <table class="wide">
      <thead>
        <tr>
          <th>Opportunity</th>
          <th>Employer</th>
          <th>Deadline</th>
          <th>Status</th>
          <th>Actions</th>
          <th class="numeric" style="white-space: nowrap">
            Export <input type="checkbox" id="check-all-opportunities">
          </th>
        </tr>
      </thead>

      <tbody>
        <% opportunities.each do |opportunity| %>
          <tr class="sub-row">
            <td><%= link_to opportunity.name, admin_opportunity_path(opportunity) %></td>
            <td><%= opportunity.employer.name %>
            <td><%= date_format(opportunity.application_deadline) %></td>
            <td rowspan="2" class="double-row status">
              <%= status('Published',         opportunity.published?) %>
              <%= status('Employer Partner',  opportunity.employer_partner?) %>
              <%= status('Inbound',           opportunity.inbound?) %>
              <%= status('Recurring',         opportunity.recurring?) %>
            </td>
            <td rowspan="2" class="double-row">
              <%= link_to 'Edit', edit_admin_opportunity_path(opportunity), class: 'edit' %><br/>
              <%= link_to 'Delete', admin_opportunity_path(opportunity), method: :delete, data: { confirm: 'Are you sure?' }, class: 'delete' %><br />
              <%= link_to('Unpublish', unpublish_admin_opportunity_path(opportunity), method: :put, class: 'edit') if opportunity.published? %>
            </td>
            <td rowspan="2" class="double-row numeric"><%= check_box_tag 'export_ids[]', opportunity.id, opportunity.export, class: 'opportunity-checkbox' %></td>
          </tr>
          <tr><td colspan="3">
            <div class="summary">
              <hr>
              <%= truncate(opportunity.summary, length: 250, separator: ' ') %>
            </div>
          </td></tr>
        <% end %>
      </tbody>
    </table>

    <p>
      <%= submit_tag 'Export to CSV', id: 'export-to-csv' %>
      <%= link_to 'Clear Export List', unqueue_admin_opportunities_path, class: 'button-white' %>
    </p>
  <% end %>
<% end %>